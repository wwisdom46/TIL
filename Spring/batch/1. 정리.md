# Spring batch 란?

- Spring의 특성을 그대로 가져왔기 때문에 DI, AOP, 서비스 추상화 등 Spring 프레임워크의 주요 사용 가능.
- 스프링 배치의 실행단위인 Job과 Step을 기준으로 배치를 수행하기 쉽게 함
- 대용량 데이터를 처리하는 데에도 편리하도록 뭉텅이로 잘라 ETL 작업을 할 수 있는 Chunk(대량 묶음) 지향처리 제공

### batch application 을 만족하기 위한 조건

> 1) 대용량 데이터 - 대량의  데이터를 가져오거나/전달하거나/계산하는 등의 처리를 할 수 있어야 함
> 2) 자동화 - 심각한 문제 해결을 제외하고는 사용자 개입 없이 실행되어야 함
> 3) 견고성 - 잘못된 데이터를 충돌/중단없이 처리할 수 있어야 함
> 4) 신뢰성 - 무엇이 잘못되었는지를 추적할 수 있어야 함 (로깅, 알림)
> 5) 성능 - 지정한 시간안에 처리를 완료하거나 동시에 실행되는 다른 어플리케이션을 방해하지 않도록 수행 되어야 함


Spring Boot Batch 2.0 이상은 Spring Batch 4.0을 기반으로 하며, Spring Batch 4.0은 다음 특징이 있다.

- Java 8이상에서 동작한다.
- Spring Framework 5로 진화하며 새롭게 재배열된 의존성 트리를 지원한다.
- `ItemReaders` , `ItemProcessors`. `ItemWriters`에 대한 빌더를 제공한다.

## 기본 구조

- Job

  - JobLauncher에 의해 실행
  - 배치의 실행단위
  - N개의 Step을 실행할 수 있으며, 흐름(Flow)을 관리할 수 있다.
  - 예를들면, 하나의 Job이 A Step 실행 후 조건에 따라 B Step 또는 C Step을 실행 설정

- JobRepository

  - DB 또는 메모리에 스프링 배치가 실행될 수 있도록 배치의 메타  데이터를 관리하는 클래스

- Step

  - Job의 세부 실행단위이며, N개가 등록되어 실행
  - 실행단위는 크게 2개로 나눌 수 있음
    - Chunk 기반
      - 하나의 큰 덩어리를 n개씩 나눠서 실행.
      - ex)10000개의 데이터를 10번씩 나누어 페이징 처리를 하는 경우. tasklet 도 가능하긴 하지만 chunk가 명확히 더 책임을 나눠서 처리함
      - Chunk 기반 Step 은 ItemReader, ItemProcessor, ItemWriter가 있음. 여기서 Item은 배치 처리 대상 객체 의미

      | ItemReader | - 배치 처리 대상 객체를 읽어 ItemProcessor 또는 ItemWriter에게 전달. <br> ex) 파일 또는 DB에서 데이터를 읽는다. |
      | --- | --- |
      | ItemProcessor | - input 객체를 ouput 객체로 filtering 또는 processing 해 ItemWriter에게 전달.<br>ex) ItemReader에서 읽은 데이터를 수정 또는 ItemWriter 대상인지 filtering. <br>- ItemProcessor 는 optional 하다. <br>- ItemProcessor 가 하는 일을 ItemReader 또는 ItemWriter가 대신할 수 있다. |
        | ItemWriter | - 배치 처리 대상 객체를 처리. <br>ex) DB update를 하거나 처리 대상 사용자에게 알림 보내기 |
    - Task 기반
      - 하나의 작업 기반으로 실행.
      - ex) 10000개의 데이터를 한번에 처리. 처리 대상이 한번에 처리해도 컴퓨터 자원에 문제가 없는 경우.

## 테이블 구조

- 배치 실행을 위한 메타 데이터가 저장되는 테이블

## 참고

- [https://velog.io/@lxxjn0/Spring-Batch-Guide-01.-배치-어플리케이션이란](https://velog.io/@lxxjn0/Spring-Batch-Guide-01.-%EB%B0%B0%EC%B9%98-%EC%96%B4%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%EC%9D%B4%EB%9E%80)
- [https://cheese10yun.github.io/spring-batch-basic/](https://k9e4h.tistory.com/392)