# ****코드 커버리지(Code Coverage)****

## 1. ****코드 커버리지(Code Coverage)란?****

- 테스트 코드가 프로덕션 코드를 얼마나 실행했는지를 백분율로 나타내는 지표이다. 즉, 테스트 코드가 실제로 프로덕션 코드를 얼마나 몇 퍼센트 검증하고 있는지를 나타낸다.
- 코드 커버리지를 통해 현재 작성된 테스트 코드의 수가 충분한것인지 논의할 수 있다.
- 예를 들어 코드 커버리지 측정 기준이 실행된 함수 개수라고 하자. 프로덕션 코드에 총 100개의 함수가 있고, 테스트 코드가 그 중 50개를 실행했다면 코드 커버리지는 50%50%가 된다.

## 2. ****코드 커버리지 측정 기준****

- 코드의 커버리지 측정 기준은 여러가지가 있다.

![코드 커버리지 측정 종류](./resources/코드%20커버리지%20측정%20종류.png)

### 1) **함수(Function) 커버리지**

- 어떤 함수가 최소 1번 이상 호출되었는지를 기준으로 커버리지를 계산한다. 함수 내부의 모든 코드가 실행되었는지는 판단 기준에서 제외된다.

```java
public void a() {
  // ...
}

public void b() {
  // ...
}

public void c() {
  // ...
}

public void d() {
  // ...
}
```

- 위와 같이 4개의 함수가 있고, 테스트 코드가 `a()`와 `b()`만을 실행한다면 4개중 2개의 함수를 실행하였으므로 테스트 커버리지는 50%, 50%가 된다.

> 함수커버리지=(실행된함수의수/전체함수의수)∗100
>

### 2) **구문(Statement) 커버리지**

- 라인(Line) 커버리지라고도 불린다.
- 프로덕션 코드의 **전체 구문 중 몇 줄의 구문**이 실행되었는지를 기준으로 판단한다.

```java
public void function(int a) {
  System.out.println("1"); // A
  if (a > 10) { // B
    System.out.println("2"); // C
  }
  System.out.println("3"); // D
}
```

위 코드를 테스트할 때 `a`를 10보다 작은 값으로만 테스트한다면, A ~ D 중 C는 실행되지 않을 것이다. 
구문 커버리지의 경우 **4개의 구문 중, 3개의 구문만 실행**되었으므로 커버리지는 75% 75%로 계산된다.

> 구문커버리지=(실행된구문의수/전체구문의수)∗100
>

### 3) **결정(Decision) 커버리지**

- 브랜치(Branch) 커버리지라고도 불린다.
- 프로덕션 코드에 조건문이 있는 경우, 조건문의 **전체 조건식**이 **True인 케이스, False인 케이스 2가지가 최소한 한번 실행**되면 충족된다. 개별 조건식의 개수와는 상관없이 최소 2개의 테스트 케이스로 충족이 가능하다.

```java
if (x >= -2 && y < 4) {
  // ...
}
```

위와 같은 코드가 있다고 가정하자. 그리고 아래와 같은 테스트 케이스 2개를 실행한다.

|  | x = 3 y = 3 | x = -3 y = 5 |
| --- | --- | --- |
| x >= -2 && y < 4 | True | False |
- 위와 같은 2개의 테스트케이스가 있다고 하였을 때, 전체 조건식이 True/False가 한번씩 선택 되었으므로 결정 커버리지 기준을 만족한다.

### 4) **조건(Condition) 커버리지**

- 조건 커버리지는 결정 커버리지와 다르게, 전체 조건식이 아니라 개별 조건식을 기준으로 판단한다. 개별 조건식이 모두 참, 거짓을 한번씩 갖도록하면 조건 커버리지 기준을 만족한다.

```java
if (x >= -2 && y < 4) {
  // ...
}
```

다시 한번 위 코드를 보자.

|  | x = 3 y = 5 | x = -5 y = 2 |
| --- | --- | --- |
| x >= -2 | True | False |
| y < 4 | False | True |
- 그리고 위와 같은 테스트 케이스가 있으면, 첫번째 조건식도 모두 True/False가 선택되었고, 두번째 조건식도 모두 True/False가 한번씩 선택되었다. 따라서 조건 커버리지를 충족한다.

### 5) **조건/결정(Condition/Decision) 커버리지**

- 조건 커버리지와 결정 커버리지 모두를 만족할 때 충족되는 조건이다.
- 즉, 개별 조건과 전체 조건 모두 최소 한번식 True/False가 선택되어야 한다.

```java
if (x >= -2 && y < 4) {
  // ...
}
```

이전과 같은 코드이다. 아래의 테스트 케이스 3가지를 실행하면, 조건/결정 커버리지를 만족한다.

|  | x = 3 y = 5 | x = -5 y = 2 | x = 3 y = 3 |
| --- | --- | --- | --- |
| x >= -2 | True | False | True |
| y < 4 | False | True | True |
| x >= -2 && y < 4 | False | False | True |

## 3. ****코드 커버리지는 몇 퍼센트를 목표로 하는게 좋을까****

- 일반적으로 80% 커버리지가 좋은 목표라고 알려져있다.
- 반면, 책 클린 코더에서 로버트 마틴은 테스트 커버리지 100%는 권장이 아니라 강력히 요구되는 사항이라고 한다. 즉, 코드 커버리지에는 정답은 없다.

> 얼마만큼의 코드를 자동화한 단위 테스트로 계산해야 할까? 대답할 필요조차 없다. 모조리 다 해야 한다. 모.조.리! 100% 테스트 커버리지를 권장하냐고? 권장이 아니라 강력히 요구한다. 작성한 코드는 한 줄도 빠짐없이 전부 테스트해야 한다. 군말은 필요 없다. ― 클린 코더 (로버트 마틴 저)
>

## 4. 주의할 점

- 테스트 커버리지 100%의 함정은 항상 주의해야한다.
- 코드가 실행된다고 해서 모든 버그들이 제어되는 것이 아니기 때문에 테스트 커버리지 100%는 완벽한 소프트웨어를 나타내지 않는다.
- 따라서 맹신하면 안되고 주의가 필요하다.
- 그렇기에 필요(테스트 커버리지와 실질적으로 테스트할 수 있는 비용)에 맞추어 테스트 커버리지를 설정하고 테스트 중단점을 설정해서 테스트를 하자.

## 참고

- [https://hudi.blog/code-coverage/](https://hudi.blog/code-coverage/)
- [https://err0rcode7.github.io/backend/2021/05/11/테스트커버리지.html](https://err0rcode7.github.io/backend/2021/05/11/%ED%85%8C%EC%8A%A4%ED%8A%B8%EC%BB%A4%EB%B2%84%EB%A6%AC%EC%A7%80.html)