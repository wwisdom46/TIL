Chapter 10 "ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´"
--

10ì¥ì—ì„œ ë°°ìš¸ ë‚´ìš©

- âœ”ï¸Â **ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì†Œê°œ**
- âœ”ï¸Â **JPQL**
- Criteria
- QueryDSL
- ë„¤ì´í‹°ë¸Œ SQL - JPQLì„ ì“°ë”ë¼ë„ íŠ¹ì • ë²¤ë”ì— ì¢…ì†ì ì¸ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ê²½ìš° ì‚¬ìš©
- ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì‹¬í™”

JPAëŠ” ë‹¤ì–‘í•œ ì¿¼ë¦¬ë°©ë²•ì„ ì§€ì›í•œë‹¤.
JPQLë¡œ ì›¬ë§Œí•´ì„  ë‹¤ í•´ê²°ë˜ê¸°ëŠ” í•œë‹¤.

## **ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì†Œê°œ**

### 1. JPQL(Java Persistence Query Language)

- JPAë¥¼ ì‚¬ìš©í•˜ë©´ ì—”í‹°í‹° ê°ì²´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë°œì´ ê°€ëŠ¥í•˜ë‹¤
- ë¬¸ì œëŠ” ê²€ìƒ‰ ì¿¼ë¦¬
    - ê²€ìƒ‰ì„ í•  ë•Œì—ë„ í…Œì´ë¸”ì´ ì•„ë‹Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰
    - ëª¨ë“  DB ë°ì´í„°ë¥¼ ê°ì²´ë¡œ ë³€í™˜í•´ì„œ ê²€ìƒ‰í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥
    - ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í•„ìš”í•œ ë°ì´í„°ë§Œ DBì—ì„œ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ê²°êµ­ ê²€ìƒ‰ ì¡°ê±´ì´ í¬í•¨ëœ SQLì´ í•„ìš”í•˜ë‹¤
- JPAëŠ” SQLì„ ì¶”ìƒí™”í•œ JPQLì´ë¼ëŠ” ê°ì²´ ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ ì œê³µ
- SQLê³¼ ë¬¸ë²• ìœ ì‚¬
    - SELECT, FROM, WHERE, GROUP BY, HAVING, JOIN ì§€ì›
- JPQLì€ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œí•œ ì¿¼ë¦¬
- SQLì€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œí•œ ì¿¼ë¦¬

```java
// ê²€ìƒ‰
// ì•„ë˜ì—ì„œ m ì€ Member ìì²´ë¥¼ ê°€ì ¸ì˜¨ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸
String jpql = "select m From Mermber m where m.name like '%hello%'";
List<Member> result = em.createQuery(jpql, Member.class)
				.getResultList();
```

```sql
-- ì‹¤í–‰ëœ SQL
select
	m.id as id,
	m.age as age,
        m.username as USERNAME,
        m.team_id as TEAM_ID
from 
	Member m
where 
	m.name '%hello%'
```

- í…Œì´ë¸”ì´ ì•„ë‹Œ ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ê°ì²´ ì§€í–¥ ì¿¼ë¦¬
- SQLì„ ì¶”ìƒí™”í•´ì„œ íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ SQLì— ì˜ì¡´ X
- JPQLì„ í•œë§ˆë””ë¡œ ì •ì˜í•˜ë©´ ê°ì²´ ì§€í–¥ SQL

### 2. Criteria ì†Œê°œ

- JPQLì€ String ì´ê¸° ë•Œë¬¸ì—  ë™ì ì¿¼ë¦¬ë¥¼ ì‘ì„±í•´ì•¼ í•  ë•Œ ì–´ë ¤ì›€
- CriteriaëŠ” ë¬¸ìê°€ ì•„ë‹Œ ìë°”ì½”ë“œë¡œ JPQLì„ ì‘ì„±í•  ìˆ˜ ìˆìŒ

```java
//Criteria ì‚¬ìš© ì¤€ë¹„
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Member> query = cb.createQuery(Member.class);

//ë£¨íŠ¸ í´ë˜ìŠ¤ (ì¡°íšŒë¥¼ ì‹œì‘í•  í´ë˜ìŠ¤)
Root<Member> m = query.from(Member.class);
//ì¿¼ë¦¬ ìƒì„± 
CriteriaQuery<Member> cq = query.select(m).where(cb.equal(m.get("username"), â€œkimâ€));
List<Member> resultList = em.createQuery(cq).getResultList();
```

- JPQL ë¹Œë” ì—­í• 
- JPA ê³µì‹ ê¸°ëŠ¥
- ë³µì¡í•˜ê³  ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë ¤ìš°ë©° ì‹¤ë¬´ì—ì„œ ì˜ ì•ˆì”€
- Criteria ëŒ€ì‹  QueryDSL ì‚¬ìš© ê¶Œì¥

### 3. QueryDSL ì†Œê°œ

- ë¬¸ìê°€ ì•„ë‹Œ ìë°”ì½”ë“œë¡œ JPQLì„ ì‘ì„±í•  ìˆ˜ ìˆìŒ

```java
JPAFactoryQuery query = new JPAQueryFactory(em);
QMember m = QMember.member;
List<Member> list = 
		query.selectFrom(m)
		     .where(m.age.gt(18))
                     .orderBy(m.name.desc())
	             .fetch();
```

- JPQL ë¹Œë” ì—­í• 
- ì»´íŒŒì¼ ì‹œì ì— ë¬¸ë²• ì˜¤ë¥˜ë¥¼ ì°¾ì„ ìˆ˜ ì‰ã…†ìŒ
- ë™ì ì¿¼ë¦¬ ì‘ì„±ì´ í¸ë¦¬í•¨
- ì˜¤í”ˆì†ŒìŠ¤ì„ [http://querydsl.com/static/querydsl/5.0.0/reference/html_single/](http://querydsl.com/static/querydsl/5.0.0/reference/html_single/)
- ë‹¨ìˆœí•˜ê³  ì‰¬ì›€. ì‹¤ë¬´ ì‚¬ìš© ê¶Œì¥

### 4. ë„¤ì´í‹°ë¸ŒSQL ì†Œê°œ

- JPAê°€ ì œê³µí•˜ëŠ” SQLì„ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥

```java
String sql =â€œSELECT ID, AGE, TEAM_ID, NAME FROM MEMBER WHERE NAME = â€˜kimâ€™";
List<Member> resultList = 
			em.createNativeQuery(sql, Member.class).getResultList();
```

- JPQLë¡œ í•´ê²°í•  ìˆ˜ ì—†ëŠ” íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì˜ì¡´ì ì¸ ê¸°ëŠ¥
    - ex) ì˜¤ë¼í´ CONNECT BY, íŠ¹ì • DBë§Œ ì‚¬ìš©í•˜ëŠ” SQL íŒíŠ¸


### 5. JDBC ì§ì ‘ ì‚¬ìš©, SpringJdbcTemplate ë“±

- JPAë¥¼ ì‚¬ìš©í•˜ë©´ì„œ JDBC ì»¤ë„¥ì…˜ì„ ì§ì ‘ ì‚¬ìš©í•˜ê±°ë‚˜, ìŠ¤í”„ë§ JdbcTemplate, Mybatis ë“±ì„ í•¨ê»˜ ì‚¬ìš© ê°€ëŠ¥
    - ë‹¨, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì ì ˆí•œ ì‹œì ì— ê°•ì œë¡œ flush í•„ìš”
    - ex) JPAë¥¼ ìš°íšŒí•´ì„œ SQLì„ ì‹¤í–‰í•˜ê¸° ì§ì „ì— ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìˆ˜ë™ flush

```java
Member member = new Member();
mermber.setUsername("mermber1");
em.persist(member);

em.flush(); // ì•„ë˜ì—ì„œ ì¶œë ¥ë˜ê¸° ìœ„í•´ì„  ê°•ì œë¡œ flush

// JDBC ì»¤í…ì…˜ ì§ì ‘ ì‚¬ìš© ì˜ˆì œ
dbconnect.executeQuery("select * from member");
```
## JPQL(Java Persistence Query Language)
### 1. ê¸°ë³¸ ë¬¸ë²•ê³¼ ì¿¼ë¦¬ API

- ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ë‹¤. ë”°ë¼ì„œ í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ **ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬**í•œë‹¤.
- SQLì„ ì¶”ìƒí™”í•´ì„œ íŠ¹ì •ë°ì´í„°ë² ì´ìŠ¤ SQLì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ê²°êµ­ SQLë¡œ ë³€í™˜ëœë‹¤.

![10-1.jpeg](./resources/10-1.jpeg)

### 2. ë¬¸ë²•

- select_ë¬¸ :: =
  
               select_ì ˆ
               from_ì ˆ
               [where_ì ˆ]
               [groupby_ì ˆ]
               [having_ì ˆ]
               [orderby_ì ˆ]
- update_ë¬¸ :: =

                update_ì ˆ 
                [where_ì ˆ]

- delete_ë¬¸ :: =

                delete_ì ˆ 
                [where_ì ˆ]


- select m from **Member** as m where **m.age** > 18
- ì—”í‹°í‹°ì™€ ì†ì„±ì€ ëŒ€ì†Œë¬¸ì êµ¬ë¶„O
- JPQL í‚¤ì›Œë“œëŠ” ëŒ€ì†Œë¬¸ì êµ¬ë¶„X (SELECT, FROM, where)
- ì—”í‹°í‹° ì´ë¦„ ì‚¬ìš©, í…Œì´ë¸” ì´ë¦„ì´ ì•„ë‹˜(Member)
- **ë³„ì¹­ì€ í•„ìˆ˜(m)** (asëŠ” ìƒëµê°€ëŠ¥)
- TypeQuery
  - ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•  ë•Œ ì‚¬ìš©

    ```java
    TypedQuery<Member> query = em.createQuery("SELECT m FROM Member m", Member.class);
    ```

- Query
  - ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•˜ì§€ ì•Šì„ ë•Œ ì‚¬ìš©

    ```java
    Query query = em.createQuery("SELECT m.username, m.age from Member m");
    ```

![10-2.jpeg](./resources/10-2.jpeg)

- ê²°ê³¼ ì¡°íšŒ API
  - query.getResultList()
    - **ê²°ê³¼ê°€ í•˜ë‚˜ ì´ìƒì¼ ë•Œ**, ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
    - ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜ (NPE ë°œìƒ X)
  - query.getSingleResult()
    - **ê²°ê³¼ê°€ ì •í™•íˆ í•˜ë‚˜**, ë‹¨ì¼ ê°ì²´ ë°˜í™˜
    - ê²°ê³¼ê°€ ì—†ìœ¼ë©´ â‡’ javax.persistence.NoResultException
    - ë‘˜ ì´ìƒì´ë©´ â‡’ javax.persistence.NonUniqueResultException
    - try catch ë¬¸ ì‚¬ìš©í•´ì„œ ì—ëŸ¬ ë°©ì§€í•´ì•¼ í•¨
- íŒŒë¼ë¯¸í„° ë°”ì¸ë”©
    - ì´ë¦„ê¸°ì¤€
    
    ```java
    SELECT m FROM Member m where m.username = :username
    query.setParameter("username", usernameParam);
    ```
    
    - ìœ„ì¹˜ê¸°ì¤€ (ìœ ì§€ë³´ìˆ˜ ì–´ë µê³  ì¥ì•  ë°œìƒ ì‹œ íŒŒì•…í•˜ê¸° ì–´ë µê¸° ë•Œë¬¸ì— ì‚¬ìš©í•˜ì§€ ë§ì)
    
    ```java
    SELECT m FROM Member m where m.username = ?1
    query.setParameter(1, usernameParam);
    ```
    
  - í”„ë¡œì ì…˜
      - SELECT ì ˆì— ì¡°íšŒí•  ëŒ€ìƒì„ ì§€ì •í•˜ëŠ” ê²ƒ
      - í”„ë¡œì ì…˜ ëŒ€ìƒ: ì—”í‹°í‹°, ì„ë² ë””ë“œ íƒ€ì…, ìŠ¤ì¹¼ë¼ íƒ€ì…(ìˆ«ì, ë¬¸ìë“± ê¸°ë³¸ ë°ì´í„° íƒ€ì…)
      - ì—”í‹°í‹° í”„ë¡œì ì…˜
          - ì¡°íšŒí•œ ì—”í‹°í‹°ëŠ”Â **ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸** ì—ì„œ ê´€ë¦¬ëœë‹¤.
          - SELECT **m** FROM Member m
    
      ```java
      Member member = new Member();
      member.setUsername("member1");
      member.setAge(10);
      em.persist(member);
    
      List<Member> result = em.createQuery("select m from Member m", Member.class)
              .getResultList();
      ```
    
      ì¼ë°˜ì ì¸ ì¡°íšŒ ë°©ë²•ì€ ì—¬íƒœ ì¨ì™”ë˜ ë°©ì‹ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë©´ ëœë‹¤. 
    
      â­ï¸ ì´ë ‡ê²Œ ì—¬ëŸ¬ê±´ì„ ì¡°íšŒí•´ì™€ë„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ëª¨ë‘ ì˜¬ë¼ê°ˆê¹Œ?
    
      ```java
      em.flush();
      em.clear();
    
      List<Member> result = em.createQuery("select m from Member m", Member.class)
              .getResultList();
    
      Member findMember = result.get(0);
      findMember.setAge(20);
      ```
    
      ì²˜ìŒ ì˜ˆì œì—ì„œ ì¶”ê°€ë¡œ ì½”ë“œë¥¼ ë„£ì–´ì¤¬ë‹¤. ë¨¼ì € ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ëª¨ë‘ ë¹„ìš°ê³  Memberë¥¼ ì¡°íšŒí•œë‹¤. 
    
      ê·¸ë¦¬ê³  ë‚˜ì„œ Memberë¥¼ í•˜ë‚˜ ê°€ì ¸ì˜¤ê³  ê·¸ Memberì˜ Ageë¥¼ ë°”ê¿”ì¤€ë‹¤. 
    
      ë§Œì•½ UPDATE ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬ê°€ ë˜ê³  ìˆëŠ” ê²ƒì´ê³ , ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì—†ë‹¤ëŠ” ë§ì´ë‹¤.
    
      ```java
      Hibernate: 
          /* update
              jpql.Member */ update
                  Member 
              set
                  age=?,
                  TEAM_ID=?,
                  username=? 
              where
                  id=?
      ```
    
      ì¶œë ¥ ë¡œê·¸ë¥¼ í™•ì¸í•´ë³´ë©´ UPDATE ì¿¼ë¦¬ê°€ ì˜ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. JPAì—ì„œ 1ê°œë“  10ê°œë“  100ê°œë“  ì¡°**íšŒí•´ì˜¤ëŠ” ëª¨ë“  ë°ì´í„°ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¡œ ì˜¬ë¼ê°„ë‹¤.**
    
      - SELECT **m.team** FROM Member m
    
      ```java
      List<Team> result = em.createQuery("select m.team from Member m", Team.class)
              .getResultList();
      ```
    
      ì½”ë“œë¥¼ ìœ„ì™€ ê°™ì´ ìˆ˜ì •í•œë‹¤. ì¡°íšŒë¥¼ í•´ ì˜¤ëŠ” ë°ì´í„°ê°€ m.teamì´ë¯€ë¡œ Team.classë¡œ ë³€ê²½í•´ì•¼í•œë‹¤. ê·¸ë¦¬ê³  ì‹¤í–‰ì„ í•´ë³´ë©´ JOIN ì¿¼ë¦¬ê°€ ì‹¤í–‰ë¨
    
      ```java
      Hibernate: 
          /* select
              m.team 
          from
              Member m */ select
                  team1_.id as id1_3_,
                  team1_.name as name2_3_ 
              from
                  Member member0_ 
              inner join
                  Team team1_ 
                      on member0_.TEAM_ID=team1_.id
      ```
    
      ì‹¬í”Œí•˜ê²Œ JPQLë¡œ ì‘ì„±í–ˆëŠ”ë° ì¿¼ë¦¬ëŠ” ë³µì¡í•˜ê²Œ ì‹¤í–‰ë¨. ì¢‹ì€ ê¸°ëŠ¥ ê°™ì§€ë§Œ  JOINì˜ ê²½ìš°ì—” ì„±ëŠ¥ê³¼ ì§ì ‘ì ìœ¼ë¡œ ì—°ê´€ë˜ì–´ ìˆëŠ” ê¸°ëŠ¥ì´ê¸°ë„ í•˜ê³  íŠœë‹ë„ í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í•œ ëˆˆì— ë³´ì—¬ì•¼í•˜ëŠ”ê²Œ ì¢‹ìŒ. 
    
      ë”°ë¼ì„œ ì½”ë“œë¥¼ ì•„ë˜ì™€ ê°™ì´ **Join ì„ ì‚¬ìš©í•˜ì—¬ ì§ê´€ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì¶”ì²œ**
    
      ```java
      List<Team> result = em.createQuery("select m.team from Member m join m.team t", Team.class)
              .getResultList();
      ```
    
      - ì„ë² ë””ë“œ íƒ€ì… í”„ë¡œì ì…˜
          - **ì„ë² ë””ë“œ íƒ€ì…ì€ ì—”í‹°í‹° íƒ€ì…ì´ ì•„ë‹Œ ê°’ íƒ€ì…ì´ë‹¤. ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ë˜ì§€ ì•ŠëŠ”ë‹¤.**
          - SELECT **m.address** FROM Member m
        
          ```java
          List<Address> result = em.createQuery("select o.address from Order o", Address.class)
                  .getResultList();
          ```
        
          ì•„ë˜ ì²˜ëŸ¼ ì‚¬ìš© ë¶ˆê°€ëŠ¥(AddressëŠ” ì–´ë–¤ ë‹¤ë¥¸ ê°ì²´ì— ì†Œì†ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ë‹¨ë…ìœ¼ë¡œ ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥)
        
          ```java
          List<Address> result = em.createQuery("select a from Address a", Address.class)
          .getResultList();
          ```
      - ìŠ¤ì¹¼ë¼ íƒ€ì… í”„ë¡œì ì…˜
           - ê¸°ë³¸ ë°ì´í„° íƒ€ì…
        ```java
        SELECT **m.username, m.age** FROM Member m
        ```        
      - DISTINCTë¡œ ì¤‘ë³µ ì œê±°
      
        ```java
        SELECT DISTINCT username FROM Member m
        ```
    
    - ì—¬ëŸ¬ ê°’ ì¡°íšŒ
    
      ```java
      em.createQuery("select distinct m.username, m.age from Member m")
              .getResultList();
      ```
    
      ìŠ¤ì¹¼ë¼ íƒ€ì…ì—ëŠ” usernameê³¼ age ë‘ ê°œì˜ í•„ë“œê°€ ì¡´ì¬í•œë‹¤. ì´ ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ê°€ì ¸ì™€ì•¼ í• ê¹Œ?
    
    1) Query íƒ€ì… ì‚¬ìš©(ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•˜ì§€ ì•Šì„ ë•Œ)
    
      ```java
      Query query = em.createQuery("select distinct m.username, m.age from Member m")
              .getResultList();
      List resultList = query.getResultList();
      ```
    
      Query íƒ€ì…ì˜ ë°˜í™˜ ê°’ì€ Listì´ë‹¤. Listì—ëŠ” íŠ¹ì • íƒ€ì…ì„ ë„£ì„ ìˆ˜ ì—†ìœ¼ë‹ˆ Objectë¡œ ëŒë ¤ì¤€ë‹¤. 
    
      ë”°ë¼ì„œ ê°’ì„ ê°€ì ¸ì˜¬ ë•ŒëŠ” ì•„ë˜ì™€ ê°™ì´ í˜•ë³€í™˜ì„ í†µí•´ ê°’ì„ ê°€ì ¸ì™€ì•¼ í•œë‹¤.
    
      ```java
      Object o = resultList.get(0);
      Object[] result = (Object[]) o;
      System.out.println("result = " + result[0]);
      System.out.println("result = " + result[1]);
      ```
    
      ```java
      // ì¶œë ¥ ë¡œê·¸
      Hibernate:
          /* select
              distinct m.username,
              m.age
          from
              Member m */ select
                  distinct member0_.username as col_0_0_,
                  member0_.age as col_1_0_
              from
                  Member member0_
      result = member1
      result = 10
      ```
    
      2) Object[] íƒ€ì… ì‚¬ìš©
          - List ì œë„¤ë¦­ì— Object[]ë¥¼ ë„£ì–´ì£¼ë©´ í˜•ë³€í™˜ ì‘ì—… ìƒëµ ê°€ëŠ¥
    
      ```java
      List<Object[]> resultList = em.createQuery("select distinct m.username, m.age from Member m")
              .getResultList();
    
      Object[] result = resultList.get(0);
      System.out.println("result = " + result[0]);
      System.out.println("result = " + result[1]);
      ```
    
      3) new ëª…ë ¹ì–´ ì‚¬ìš©
          - ì œì¼ ê¹”ë”í•œ ë°©ë²•
          - ë‹¨ìˆœ ê°’ì„ DTOë¡œ ë°”ë¡œ ì¡°íšŒ
          - íŒ¨í‚¤ì§€ëª…ì„ í¬í•¨í•œ ì „ì²´ í´ë˜ìŠ¤ ëª… ì…ë ¥
          - ìˆœì„œì™€ íƒ€ì…ì´ ì¼ì¹˜í•˜ëŠ” ìƒì„±ì í•„ìš”

      MemberDTO í´ë˜ìŠ¤ ìƒì„±
    
    ```java
    public class MemberDTO {
    
        private String username;
        private int age;
    
        public MemberDTO(String username, int age) {
            this.username = username;
            this.age = age;
        }
        // getter/setter ìƒëµ
    }
    ```
    
    ì‹¤í–‰ í´ë˜ìŠ¤ ì½”ë“œ
    
    ```java
    TypedQuery<MemberDTO> query = em.createQuery("select new jpql.MemberDTO(m.username, m.age) from Member m", MemberDTO.class);
    
    List<MemberDTO> resultList = query.getResultList();
    
    MemberDTO memberDTO = resultList.get(0);
    System.out.println("memberDTO = " + memberDTO.getUsername());
    System.out.println("memberDTO = " + memberDTO.getAge());
    ```
    
    ì›í•˜ëŠ”ëŒ€ë¡œ ì‘ë™ì´ ë˜ì§€ë§Œ ì¿¼ë¦¬ì— êµ¬êµ¬ì ˆì ˆ íŒ¨í‚¤ì§€ëª…ì„ ì ì–´ì•¼ í•˜ëŠ”ê²Œ ë§ë‚˜ ì‹¶ê¸°ë„ í•˜ë‹¤. 
    
    ì¶”í›„ QueryDSLì„ ì‚¬ìš©í•˜ë©´ ì´ëŸ° ë¶ˆí¸í•œ ë¶€ë¶„ì„ ê·¹ë³µ ê°€ëŠ¥!
    
- í˜ì´ì§• API
    - **setFirstResult(int startPosition)**Â : ì¡°íšŒ ì‹œì‘ ìœ„ì¹˜(0ë¶€í„° ì‹œì‘)
    - **setMaxResults(int maxResult)**Â : ì¡°íšŒí•  ë°ì´í„° ìˆ˜

  ```java
  TypeQuery<Member> query = 
      em.createQuery("SELECT m FROM Member m ORDER BY m.username DESC",
      Member.class);
  
  // 11ë²ˆì§¸ë¶€í„° 20ê±´ì˜ ë°ì´í„° ì¡°íšŒ, 11~30    
  query.setFirstResult(10);
  query.setMaxResult(20);
  query.getResultList();
  ```

- ì§‘í•©ê³¼ ì •ë ¬
    - COUNT, SUM, MIN, ORDER BY, GROUP BYâ€¦ pass
- ì¡°ì¸
    - SQL ì¡°ì¸ê³¼ ê¸°ëŠ¥ì€ ê°™ê³  ë¬¸ë²•ë§Œ ì•½ê°„ ë‹¤ë¥´ë‹¤.
    - ë‚´ë¶€ ì¡°ì¸
        - **INNER JOIN ì‚¬ìš©, INNER** ëŠ” ìƒëµ ê°€ëŠ¥
    
    ```java
    SELECT m FROM Member m [INNER] JOIN m.team t
    ```
    
    - ì™¸ë¶€ ì¡°ì¸
        - **OUTER ìƒëµê°€ëŠ¥**. ë³´í†µÂ **LEFT JOIN** ìœ¼ë¡œ ì‚¬ìš©
    
    ```java
    SELECT m FROM Member m LEFT [OUTER] JOIN m.team t
    ```
    
    - ì„¸íƒ€ ì¡°ì¸
        - ì—°ê´€ê´€ê³„ê°€ ì—†ì§€ë§Œ ì¡°íšŒí•´ë³´ê³  ì‹¶ì„ ë•Œ
        - ë‚´ë¶€ ì¡°ì¸ë§Œ ì§€ì›
    
    ```java
    select count(m) from Member m, Team t where m.username = t.name
    
    SELECT COUNT(M.ID)
    FROM MEMBER M CROSS JOIN TEAM T
    WHERE M.USERNAME = T.NAME
    ```
    
    - ON ì ˆ(JPA 2.1ë¶€í„° ì§€ì›)
    
- **ê²½ë¡œ í‘œí˜„ì‹**
    - ì (.)ì„ ì°ì–´ ê°ì²´ ê·¸ë˜í”„ë¥¼ íƒìƒ‰í•˜ëŠ” ê²ƒ
    - **m.username, m.team, m.orders, t.name ëª¨ë‘ ê²½ë¡œ í‘œí˜„ì‹**

```java
select m.username
from Member m
    join m.team t
    join m.orders o
where t.name = 'íŒ€A'
```

   - ë§ì´ í•˜ëŠ” ì‹¤ìˆ˜ : ì»¬ë ‰ì…˜ ê°’ì—ì„œ ê²½ë¡œ íƒìƒ‰ ì‹œë„

```java
select t.members from Team t            //ì„±ê³µ
select t.members.username from Team t   //ì‹¤íŒ¨
```

- ì»¬ë ‰ì…˜ì—ì„œ ê²½ë¡œ íƒìƒ‰í•˜ë ¤ë©´

```java
// join t.members mìœ¼ë¡œ ì»¬ë ‰ì…˜ì— ìƒˆë¡œìš´ ë³„ì¹­ì„ ì–»ìŒ.
select m.username from Team t join t.members m
```

- SIZEë¼ëŠ” íŠ¹ë³„í•œ ê¸°ëŠ¥ ì œê³µ

```java
select t.members.size from Team t
```

- ì„œë¸Œì¿¼ë¦¬
    - SQLì²˜ëŸ¼ ì„œë¸Œ ì¿¼ë¦¬ ì§€ì›
    
- ì¡°ê±´ì‹
    - íƒ€ì…í‘œí˜„
  
        | ì¢…ë¥˜ | ì˜ˆì œ |
        | --- | --- |
        | ë¬¸ì | 'HELLO', 'Hi' |
        | ìˆ«ì | 10L, 10D, 10F |
        | ë‚ ì§œ | {d'2012-03-24'} |
        | íƒ€ì„ | {t'10-11-11'} |
        | DATETIME | [ts'2014-03-24 10-11-11.123'} |
        | Enum | jpabook.MemberType.Admin |
        | ì—”í‹°í‹° íƒ€ì… | TYPE(m) = Member |

    - Between, IN, Like, Null
    - ë‚ ì§œí•¨ìˆ˜
        - CURRENT_DATE : í˜„ì¬ ë‚ ì§œ
        - CURRENT_TIME : í˜„ì¬ ì‹œê°„
        - CURRENT_TIMESTAMP : í˜„ì¬ ë‚ ì§œ ì‹œê°„
    - CASE
        - ê¸°ë³¸ CASE
        - COALESCE
            - nullì´ ì•„ë‹ˆë©´ ë°˜í™˜
        
        ```java
        // m.usernameì´ nullì´ë©´ 'ì´ë¦„ì—†ëŠ” íšŒì›' ë°˜í™˜
        select coalesce(m.username, 'ì´ë¦„ì—†ëŠ” íšŒì›') from Member m
        ```
        
- Named ì¿¼ë¦¬
    - ì–´í”Œë¦¬ì¼€ì´ì…˜ ë¡œë”© ì‹œì ì— JPQL ë¬¸ë²•ì„ ì²´í¬í•˜ê³  ë¯¸ë¦¬ íŒŒì‹±í•´ì¤Œ
    - ì˜¤ë¥˜ë¥¼ ë¹¨ë¦¬ í™•ì¸í•  ìˆ˜ ìˆê³ , ì‚¬ìš©í•˜ëŠ” ì‹œì ì—ëŠ” íŒŒì‹±ëœ ê²°ê³¼ë¥¼ ì¬ì‚¬ìš©
    - ì„±ëŠ¥ìƒ ğŸ‘
    - **@NamedQuery ì–´ë…¸í…Œì´ì…˜ì´ë‚˜ XMLì— ì‘ì„± ê°€ëŠ¥**    - 
    
    ```java
    @Entity
    @NamedQuery(
        name = "Member.findByUsername",
        query = "select m from Member m where m.username = :username")
    public class Member {
        ... 
    }
    
    // ì‚¬ìš©
    List<Member> resultList = em.createNamedQuery("Member.findByUsername"),
                Member.class)
                .setParameter("username", "íšŒì›1")
                .getResultList();
    
    ```
    
    - 2ê°œ ì´ìƒ ì •ì˜
    
      - @NamedQueries ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš©
    
    ```java
    @Entity
    @NamedQueries({
        @NamedQuery(
            name = "Member.findByUsername",
            query = "select m from Member m where m.username = :username"),
        @NamedQuery(
            name = "Member.count"
            query = "select count(m) from Member m")
    })
    public class Member { ... }
    ```